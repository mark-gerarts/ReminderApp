<!DOCTYPE html>
<!-- prince -s style.css index.html mybook.pdf -->
<!-- prince  index.html builds/eindwerk.pdf  --javascript -->
<html dir="ltr" lang="en-US">
<head>
    <meta charset="utf-8" />
    <title>Eindwerk Paper</title>
    <meta name="author" content="Mark gerarts"/>
    <meta name="subject" content="Eindwerk Syntra Webontwikkelaar 2015-2016: ReminderApp"/>
    <link rel="stylesheet" href="instantHighlightJS/prism.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="frontcover">
    <img src="images/syntra-logo.jpg" id="logo" />
    <div id="title">
        <h2>RemindMe</h2>
    </div>
</div>
<div class="contents">
    <h1>Inhoud</h1>

    <ul class="toc">
        <li><a href="#ch1"></a></li>
        <li><a href="#ch2"></a></li>
        <li><a href="#ch3"></a></li>
        <li><a href="#ch4"></a>
            <ul class="toc toc-sub">
                <li><a href="#sub4-1"></a></li>
                <li><a href="#sub4-2"></a></li>
                <li><a href="#sub4-3"></a></li>
                <li><a href="#sub4-4"></a></li>
                <li><a href="#sub4-5"></a></li>
                <li><a href="#sub4-6"></a></li>
                <li><a href="#sub4-7"></a></li>
                <li><a href="#sub4-7"></a></li>
            </ul>
        </li>
        <li><a href="#ch5"></a>
            <ul class="toc toc-sub">
                <li><a href="#sub5-1"></a></li>
                <li><a href="#sub5-2"></a></li>
                <li><a href="#sub5-3"></a></li>
                <li><a href="#sub5-4"></a></li>
                <li><a href="#sub5-5"></a></li>
                <li><a href="#sub5-6"></a></li>
                <li><a href="#sub5-7"></a></li>
                <li><a href="#sub5-8"></a></li>
                <li><a href="#sub5-9"></a></li>
                <li><a href="#sub5-10"></a></li>
            </ul>
        </li>
        <li><a href="#ch6"></a></li>
    </ul>

</div>

<!-- Inleiding en samenvatting omwisselen, a la abstract //-->
<h1 id="ch1" class="chapter">Inleiding</h1>
    <div>
        <p>
            RemindMe is een webapplicatie waarmee gebruikers een herinnering kunnen maken, die ze later dan per sms toegestuurd krijgen. Er kan een account aangemaakt worden. Dit biedt
            onder andere de mogelijkheid om contacten te beheren en herinneringen te laten herhalen. Registreren is echter niet nodig, er kon ook een
            zogenaamde 'Quick reminder' gemaakt worden. Het nadeel hiervan is dat de prijs veel hoger ligt.
        </p>
        <p>
            De applicatie is geschreven in Laravel. Wanneer een gebruiker zich inlogt, komt hij terecht bij het 'dashboard'. Dit deel van de site maakt gebruikt van het JavaScript
            framework Vue.js. Deze communiceert met de backend door middel van een API.

        </p>
    </div>

<h1 id="ch2" class="chapter">Samenvatting</h1>
    <p>Zie inleiding.</p>

<h1 id="ch3" class="chapter">Database</h1>
    <div>
        <p>
            De applicatie maakt gebruik van een MySQL (MariaDB) database. De structuur ziet er als volgt uit:
        </p>
        <!-- Database tables a la MySQL //-->
        <div class="db-wrapper">
            <!-- Users //-->
            <ul class="db-table">
                <li class="db-header">users</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />name
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />email
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />password
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />reminder_credits
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />remember_token
                    <span class="db-datatype"> : varchar(100)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- User_reminders //-->
            <ul class="db-table">
                <li class="db-header">user_reminders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />recipient
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />contact_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />send_datetime
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />message
                    <span class="db-datatype"> : text</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />repeat_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- User_orders //-->
            <ul class="db-table">
                <li class="db-header">user_orders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />payment_id
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />amount
                    <span class="db-datatype"> : decimal(8,2)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />reminder_credits
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- Quick reminders //-->
            <ul class="db-table">
                <li class="db-header">quick_reminders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />recipient
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />send_datetime
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />message
                    <span class="db-datatype"> : text</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />is_payed :
                    <span class="db-datatype"> : tinyint(1)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />payment_id
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
            </ul>
            <!-- Contacts //-->
            <ul class="db-table">
                <li class="db-header">contacts</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />name
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />number
                    <span class="db-datatype"> : varchar(20)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
            </ul>
            <!-- Password_resets //-->
            <ul class="db-table">
                <li class="db-header">password_resets</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />email
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />token
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- Repeats //-->
            <ul class="db-table" id="db-table-repeats">
                <li class="db-header">repeats</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />repeat_interval
                    <span class="db-datatype"> : varchar(20)</span>
                </li>
            </ul>
        </div>
        <p>
            <strong>Users:</strong><br />
            Deze tabel bevat details over de gebruiker, samen met een aantal timestamps. Het wachtwoord wordt gehashed in de database opgeslagen. Het veld "reminder_credits" bevat
            het aantal reminders dat de gebruiker nog heeft.
        </p>
        <p>
            <strong>User_reminders</strong><br />
            Bevat reminders die door een geregistreerde gebruiker gemaakt zijn. Zo'n reminder wordt ofwel naar een opgeslagen contact verstuurd, of naar een willekeurig nummer. Daarom
            heeft deze tabel naast het veld "recipient" ook nog een referentie naar de Contacts tabel.
        </p>
        <p>
            <strong>User_orders</strong><br />
            Bevat gegevens over betalingen die door geregistreerde gebruikers worden uitgevoerd. Zo wordt het bedrag opgeslagen, en het aantal reminders dat gekocht werd. "Payment_id"
            verwijst naar de betaling die via de Mollie API wordt gemaakt. Dit kan gebruikt worden om de betalingsstatus na te gaan.
        </p>
        <p>
            <strong>Quick_reminders</strong><br />
            Hier worden alle details opgeslagen over reminders die door niet-geregistreerde gebruikers worden gemaakt. Ook hier wordt een referentie naar de betaling van Mollie bijgehouden.
            Ook is er een boolean voorzien om na te gaan of de betaling al voltooid is of niet. Dit om ervoor te zorgen dat er niet elke minuut een request naar de Mollie API gestuurd dient
            te worden.
        </p>
        <p>
            <strong>Contacts</strong><br />
            De tabel om contacten in op te slaan. Elke rij bevat een verwijzing naar de user waarmee ze geässocieerd is.
        </p>
        <p>
            <strong>Password_resets</strong><br />
            Deze tabel is nodig om gebruikers de mogelijkheid te geven hun wachtwoord te veranderen.
        </p>
        <p>
            <strong>Repeats</strong><br />
            Dit is niet meer dan een enum voor de beschikbare herhalingen.
        </p>
    </div>

<h1 id="ch4" class="chapter">Backend</h1>
    <h2 class="subtitle" id="sub4-1">Gebruikte technologiën</h2>
    <div>
        <table class="gebruikte-techs">
            <tbody>
                <tr>
                    <td>
                        <img src="images/techs/laravel.png" id="logo-laravel"/>
                    </td>
                    <td>
                        <span class="tech-title">Laravel 5.2</span><br />
                        Laravel is het meest gebruikte PHP framework. Het bevat veel tools die het ontwikkelingsproces helpen versnellen. Zo maakt het gebruik
                        van artisan om code te genereren voor veelgebruikte zaken. De Eloquent ORM vergemakkelijkt database operaties, en het Blade templating
                        systeem zorgt voor overzichtelijke views.
                        Bovenop dit alles beschikt Laravel over een expressieve en elegante syntax.<br />
                        Persoonlijk heb ik voor Laravel gekozen omwille van de gelijkenissen met ASP.NET, een C# framework waar ik al eerder ervaring in had.
                        <br /><span class="tech-alts">Alternatieven:</span> CodeIgniter, CakePHP, Symfony
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/twilio.png" id="logo-twilio"/>
                    </td>
                    <td>
                        <span class="tech-title">Twilio</span><br />
                        Om SMS-berichten te versturen kunnen maakt de applicatie gebruik van Twilio. Deze service voorziet een API, waardoor een bericht
                        verstuurd kan worden door middel van een HTTP request. Twilio voorziet ook een library die beschikbaar is via Composer. Dit zorgt ervoor
                        dat de service snel opgezet kan worden.
                        <br /><span class="tech-alts">Alternatieven:</span> Plivo, Nexmo
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/mollie.png" id="logo-mollie"/>
                    </td>
                    <td>
                        <span class="tech-title">Mollie</span><br />
                        Mollie is een service om online betalingen te regelen. Het voorziet veel betalingsmogelijkheden, gaande van Bancontact tot Paypal en zelfs
                        bitcoin. Mollie host een API en voorziet hiervoor ook een PHP library, wat maakt dat er met een paar regels code al een betaling kan worden
                        uitgevoerd.<br />
                        Voor de ontwikkeling van een applicatie kan een test-API gebruikt worden. Deze stelt de developer in staat om betalingen na te bootsen, zonder
                        deze effectief uit te voeren.
                        <br /><span class="tech-alts">Alternatieven:</span> Adyen, Ingenico
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/jwt.png" id="logo-jwt"/>
                    </td>
                    <td>
                        <span class="tech-title">JSON Web Token</span><br />
                        De applicatie maakt hevig gebruik van een API. Een RESTful API is per definitie stateless. Dit wil zeggen dat session-based authenticatie geen
                        goede optie is. JSON Web Token (JWT) biedt hiervoor een oplossing. Een token bevat geëncrypteerde authenticatiegegevens van de gebruiker, en wordt
                        client-side bijgehouden. Dit token wordt meegegeven in de header van elk request naar de API, om zo de gebruiker te kunnen authenticeren.<br />
                        De applicatie maakt gebruik van de opensource tymon/jwt-auth library, specifiek voor Laravel.
                        <br /><span class="tech-alts">Alternatieven:</span> OAuth, basic
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h2 class="subtitle" id="sub4-2">Structuur</h2>
    <div>
        <p>
            Het informatieve deel van de applicatie is een 'normale' website. Het gaat over de homepage, de contactpagina en de pricing pagina. Dit
            zijn vrijwel volledig statische pagina's.
        </p>
        <p>
            Het dashboard daarentegen is een zogenaamde 'Single Page Application (SPA)'. Bij het navigeren naar het dashboard wordt eenmalig alle nodige code geladen.
            Een JavaScript framework zorgt ervoor dat alle requests asynchroon geladen worden. Ook de routing wordt afgehandeld door het framework. Hierdoor hoeft de gebruiker
            nooit rechtstreeks een nieuwe pagina op te vragen of te herladen. Dit zorgt voor een vlotte user experience.<br />
            Om dit allemaal te kunnen voorzien maakt de applicatie gebruik van een RESTful API.
        </p>
        <p>
            De API voorziet een aantal endpoints om met de applicatie te werken. Ze maakt gebruik van de zogenaamde 'HTTP werkwoorden' die overeenstemmen met een CRUD operatie.
            Zo staat een POST request voor een insert, GET voor een read, PUT voor een update, en een DELETE request zorgt voor een delete.<br />
            Deze requests worden gebundeld onder de 'api' route. Om bijvoorbeeld alle contacten op te vragen, dient er een GET request gestuurd te worden naar '../api/contacts'.
            De API maakt gebruik van JSON als dataformaat. De server stuurt ook logische HTTP statuscodes. Een niet gevonden record geeft bijvoorbeeld een 404 als antwoord, of
            een niet geauthorizeerde actie levert een 403 op.
        </p>
        <table class="api-endpoints">
            <thead>
                <tr>
                    <th>Endpoint</th>
                    <th>Method</th>
                    <th>Omschrijving</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>/contacts/{id?}</td>
                    <td>GET</td>
                    <td>Antwoord met een array van alle contactpersonen van de geauthenticeerde gebruiker, of met slechts 1 contactpersoon als er een id wordt gegeven</td>
                </tr>
                <tr>
                    <td>/contacts</td>
                    <td>POST</td>
                    <td>Insert een contactpersoon aan de hand van de POST-gegevens.</td>
                </tr>
                <tr>
                    <td>/contacts/{id}</td>
                    <td>DELETE</td>
                    <td>Delete de contactpersoon met het gegeven ID.</td>
                </tr>
                <tr class="section-end">
                    <td>/contacts</td>
                    <td>PUT</td>
                    <td>Update de contactpersoon aan de hand van de gegevens.</td>
                </tr>
                <tr>
                    <td>/reminders/upcoming</td>
                    <td>GET</td>
                    <td>Antwoord met een array van alle reminders met een datum later dan vandaag.</td>
                </tr>
                <tr>
                    <td>/reminders/cancel/{id}</td>
                    <td>GET</td>
                    <td>Annuleert de reminder met het gegeven ID.</td>
                </tr>
                <tr>
                    <td>/reminders</td>
                    <td>POST</td>
                    <td>Insert een nieuwe reminder aan de hand van de POST-gegevens.</td>
                </tr>
                <tr class="section-end">
                    <td>/quickreminder</td>
                    <td>POST</td>
                    <td>Insert een quick reminder aan de hand van de POST-gegevens.</td>
                </tr>
                <tr>
                    <td>/login</td>
                    <td>POST</td>
                    <td>Probeert een gebruiker te authenticeren. Antwoord met een JWT als de authenticatie succesvol is</td>
                </tr>
                <tr>
                    <td>/register</td>
                    <td>POST</td>
                    <td>Registreert een nieuwe gebruiker.</td>
                </tr>
                <tr>
                    <td>/user</td>
                    <td>GET</td>
                    <td>Antwoord met enkele gegevens van de geauthenticeerde gebruiker.</td>
                </tr>
            </tbody>
        </table>
    </div>
    <h2 class="subtitle" id="sub4-3">Models & Repositories</h2>
    <div>
        <p>
            <span class="p-subtitle">Eloquent ORM</span><br />
            Laravel maakt gebruikt van het Eloquent ORM. Elk Eloquent model komt overeen met een tabel in de database. Op dit model kunnen dan relaties
            gedefiniëerd worden. Standaard komt de classnaam overeen met de tabelnaam. Zo zal het model Contact queries uitvoeren op de 'contacts' tabel.
            Het Contact model ziet er bijvoorbeeld als volgt uit:
        </p>
        <!-- Contact Model code -->
    <pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">Contact</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$timestamps</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            De <code>$timestamps</code> property wordt gebruikt om aan te duiden of er voor een model de datum moet worden bijgehouden waarop het aangemaakt of gewijzigd wordt.<br />
            Relaties met andere tabellen worden aangeduid aan de hand van functies. Zo wordt bijvoorbeeld een OneToMany relatie uitgedrukt door <code>hasMany()</code> en
            <code>belongsTo()</code>.
        </p>
        <p>
            Eloquent zorgt ervoor dat veelgebruikte queries geëncapsuleerd worden op de models. Zo voorziet het enkele logische functies zoals <code>delete()</code>, <code>save()</code>,
            <code>where()</code>, enz.
            Meer complexe operaties kunnen nog altijd in rauwe SQL worden uitgevoerd.
        </p>
        <p>
            <span class="p-subtitle">Repository pattern</span><br />
            De applicatie maakt gebruik van het repository pattern. Dit is een extra abstractie van de database layer. Een repository bundelt een aantal operaties op
            een model in een class. De controller hoeft dan niet langer rechtstreeks de database layer aan te spreken via de models, maar gebruikt in de plaats de
            repositories.<br />
            De repository en het model zijn zo echter wel nog tightly coupled. Om dit tegen te gaan worden interfaces gebruikt. De interface definiëert een 'contract'
            waar de repository zich aan moet houden. In de controller wordt vervolgens de interface als dependency gebruikt. Nu maakt het niet meer uit hoe de data
            opgehaald wordt, als de implementatie zich maar aan de interface houdt. <br />
            Het gebruik van repositories zorgt niet enkele voor beter leesbare code, maar verbetert ook de mogelijkheid
            tot unit testing.
        </p>
        <p>
            De interface voor de contactpersonen ziet er bijvoorbeeld als volgt uit:
        </p>
        <!-- Code voor de repositoryinterface //-->
    <pre class="language-php"><code><span class="token keyword">interface</span> <span class="token class-name">IContactRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactById</span><span class="token punctuation">(</span><span class="token variable">$contactid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactsByUserId</span><span class="token punctuation">(</span><span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insertContact</span><span class="token punctuation">(</span><span class="token variable">$contact</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">deleteContact</span><span class="token punctuation">(</span><span class="token variable">$contactid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updateContact</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$newValues</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Vervolgens implementeert de repository de bijhorende interface. Zo ziet de <code>getContactsByUserId()</code> er als volgt uit.
        </p>
        <!-- Code voor de interface implementatie //-->
    <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Repositories<span class="token punctuation">\</span>Contact</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Contact</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ContactRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IContactRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_contact</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Contact <span class="token variable">$contact</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contact</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactsByUserId</span><span class="token punctuation">(</span><span class="token variable">$userid</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">,</span> <span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
        <p>Om de repository te gebruiken wordt de interface geïnjecteerd in de constructor.</p>
        <!-- Constructor code //-->
    <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>IContactRepository <span class="token variable">$contact</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Omdat enkel de interface wordt gebruikt in de controller, weet Laravel niet welke implementatie ze hiervoor moet gebruiken. Daarom moeten de interface en
            de bijhorende implementatie aan elkaar gekoppeld worden. Dit gebeurt in de <code>register</code> method in de <code>AppServiceProvider</code>.
         </p>
         <!-- Code voor de app_>bind() //-->
         <pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'App\Repositories\Contact\IContactRepository'</span><span class="token punctuation">,</span>
        <span class="token string">'App\Repositories\Contact\ContactRepository'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
        <p>
            <span class="p-subtitle">Structuur</span><br />
            Elk model krijgt op deze manier zijn eigen repository. Omdat dit project relatief klein is, heeft elke repository zijn eigen interface.
            Een betere oplossing voor grotere projecten is om een basis interface te schrijven met algemene CRUD acties. Vervolgens kunnen specifieke
            interfaces deze erven en eventueel nog methods toevoegen of aanpassen.
        </p>
        <div class="keep-together">
            <p>
                De folderstructuur voor de models ziet er als volgt uit:
            </p>
            <pre class="folder-structure">
app/
  ...
  .
  |-- Models/
      |-- Contact.php
      |-- Quick_reminder.php
      |-- User_order.php
      |-- User_reminder.php
      `-- User.php
  `-- Repositories/
      |-- Contact/
          |-- ContactRepository.php
          `-- IContactRepository.php
      |-- Quick_reminder/
          |-- Quick_reminderRepository.php
          `-- IQuick_reminderRepository.php
      |-- User_order/
          |-- User_orderRepository.php
          `-- IUser_orderRepository.php
      |-- User_reminder/
          |-- User_reminderRepository.php
          `-- IUser_reminderRepository.php
      `-- User/
          |-- UserRepository.php
          `-- IUserRepository.php
            </pre>
        </div>
        <p>
            Alle repositories hebben enkele basis CRUD methods. De enige repository die hiervan afwijkt is de UserRepository. De <code>tymon/jwt-auth</code>
            library gebruikt standaard het zijn eigen UserInterface. Daarom moet de UserRepository een extra interface implementeren. Ook moet in
            <code>config/jwt.php</code> een verwijzing toegevoegd worden naar de nieuwe implementatie.
        </p>
        <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Repositories<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tymon<span class="token punctuation">\</span>JWTAuth<span class="token punctuation">\</span>Providers<span class="token punctuation">\</span>User<span class="token punctuation">\</span>UserInterface</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IUserRepository</span><span class="token punctuation">,</span> UserInterface
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
    </div>
    <h2 class="subtitle" id="sub4-4">Controllers</h2>
    <div>
        <p>
            De controllers worden opgesplits in twee delen. Enerzijds zijn er de controllers die verantwoordelijk zijn voor de API. Deze bevatten allerhande
            methods om de gewenste database operaties uit te voeren. Anderzijds zijn er de controllers die de webpagina's genereren. Deze doen vaak niets anders
            dan een view returnen.
        </p>
        <pre class="folder-structure">
Controllers/
  |-- API/
      |-- AuthenticateController.php
      |-- ContactsController.php
      |-- RemindersController.php
      `-- UserController.php
  |-- Controller.php
  |-- DashboardController.php
  |-- HomeController.php
  `-- PaymentController.php
        </pre>
        <p>
            <span class="p-subtitle">ContactsController</span><br />
            De ContactsController is niet meer dan een bundeling van CRUD operaties. De methods krijgen dan ook namen die overeenstemmen met de actie.
        </p>
        <!-- Code voor contact controller //-->
<pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>API</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Requests</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">ContactsController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_contactRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userReminderRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token variable">$_user</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            In de constructor worden de nodige repositories via dependency injection geïnstantieerd. Deze worden dan als properties bijgehouden om zo
            gebruikt te kunnen worden in de methods.
        </p>
        <!-- ContactsController constructor //-->
        <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>IContactRepository <span class="token variable">$contact</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_user</span> <span class="token operator">=</span> JWTAuth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">parseToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userRepository</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span> <span class="token operator">=</span> <span class="token variable">$userReminder</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            De ContactsController kan alleen maar gebruikt worden als de user geauthenticeerd is, en gebruikt daarom de <code>jwt.auth</code>
            middleware. Deze is gedefiniëerd in <code>routes.php</code>. De geauthenticeerde gebruiker wordt via de <code>toUser()</code> method
             in een property gestoken.
        </p>
        <p>
            Vrijwel alle methods van de controller volgen de zelfde structuur. Eerst wordt de eventuele input gevalideerd. Vervolgens wordt de
            logica uitgevoerd die van de method verwacht wordt. Ten slotte wordt er een JSON antwoord teruggestuurd. Moest er ergens in de method
            iets foutlopen, dan wordt ook een logische HTTP code teruggestuurd. Zo zal foutieve data voor een 422 code zorgen.<br />
            Als voorbeeld de <code>delete()</code> method:
        </p>
        <!-- Delete contactscontroller //-->
    <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Get the contact.</span>
    <span class="token variable">$contact</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContactById</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$contact</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">"Not found"</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// Check if the contact really belongs to the user.</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">user_id</span> <span class="token operator">!=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">"Not authorized"</span><span class="token punctuation">,</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Remove the contact id from all associated reminders, and</span>
    <span class="token comment" spellcheck="true">// set the recipient to the contact's number.</span>
    <span class="token comment" spellcheck="true">// This is so the set reminders can still be sent.</span>
    <span class="token variable">$reminders</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span>
                      <span class="token operator">-</span><span class="token operator">></span><span class="token function">getUserRemindersWhere</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"contact_id"</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$reminders</span> <span class="token keyword">as</span> <span class="token variable">$reminder</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span>
             <span class="token operator">-</span><span class="token operator">></span><span class="token function">updateUserReminder</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                 <span class="token string">"recipient"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">number</span><span class="token punctuation">,</span>
                 <span class="token string">"contact_id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span>
             <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Finally, delete the contact & return the result.</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">deleteContact</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            <span class="p-subtitle">RemindersController</span><br />
            De RemindersController is verantwoordelijk voor de operaties op de User_reminders tabel. Deze is vrijwel analoog aan de ContactsController.
            Het enige verschil hier is dat er een extra <code>_createUserReminder()</code> method is. Deze wordt gebruikt bij <code>insertReminder()</code>.
            Dit is een aparte method om de code overzichtelijker te maken.
        </p>
        <!-- RemindersController //-->
        <pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">RemindersController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userReminderRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_user</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getUpcomingReminders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insertReminder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">cancelReminder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_createUserReminder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            <span class="p-subtitle">UserController</span><br />
            De UserController heeft slechts één method, <code>getUserDetails()</code>. Deze wordt gebruikt, zoals de naam al zegt, om enkele details van
            de gebruiker op te vragen. Uiteraard gebruikt deze controller ook de <code>jwt.auth</code> middleware.
        </p>
        <p>
            <span class="p-subtitle">AuthenticateController</span><br />
            Deze controller zorgt voor de authenticatie en registratie van de gebruiker. <code>Authenticate()</code> probeert aan de hand van de logingegevens
            een JWT token aan te maken. Als de authenticatie succesvol is, worden er, samen met het token, enkele details over de gebruiker meegegeven. Dit om
            een request te besparen.<br /> De <code>register()</code> method wordt gebruikt om een gebruiker te registreren.
        </p>
        <pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">AuthenticateController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            <span class="p-subtitle">DashboardController</span><br />
            Het enige wat deze controller doet, is een view returnen voor het dashboard.
        </p>
        <p>
            <span class="p-subtitle">HomeController</span><br />
            De HomeController zorgt voor alle pagina's van de 'gewone' website: de homepage, de pricing pagina, en de contactpagina.
            Ook heeft de controller een method om het verzenden vanhet contactformulier af te handelen.
        </p>
        <p>
            <span class="p-subtitle">PaymentController</span><br />
            De PaymentController is vrijwel de meest uitgebreide controller. De controller zorgt voor zowel het kopen van quick reminders
            alsook het kopen van credits door een gebruiker. Ook zorgt deze controller voor het aanmaken van de quick reminder wanneer de
            betaling succesvol is afgehandeld.
        </p>
        <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_mollie</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userOrderRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_quickReminderRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">createUserOrder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">userOrderRedirect</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">createQuickReminderOrder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">quickReminderOrderRedirect</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Een betaling bestaat altijd uit twee delen, de <code>create</code> en de <code>redirect</code>. In de <code>create</code> wordt eerst de
            input gevalideerd. Vervolgens wordt een order aangemaakt. Deze gegevens worden hierna naar de Mollie API verstuurd. Het order wordt hierna
            geüpdate met het ID van de betaling. Ten slotte wordt de gebruiker geredirect naar de website van Mollie om te betaling te voltooien.
        </p>
        <p>
            Wanneer de gebruiker de betaling succesvol afhandelt, wordt hij doorverwezen naar de <code>redirect</code> method. Hier wordt nagegaan
            of de betaling gelukt is. Vervolgens wordt het order geupdate, en wordt de actie uitgevoerd waar de gebruiker voor betaald heeft.
        </p>
        <p>
            In de constructor wordt eerst de Mollie API library geïnstantieerd. Dit gebeurt aan de hand van de API key. Vervolgens worden ook alle
            nodige repositories geladen.
        </p>
        <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>IUserRepository <span class="token variable">$userRepository</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_mollie</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mollie_API_Client</span><span class="token punctuation">;</span>
    <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">'MOLLIE_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_mollie</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setApiKey</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userOrderRepository</span> <span class="token operator">=</span> <span class="token variable">$userOrderRepository</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userRepository</span> <span class="token operator">=</span> <span class="token variable">$userRepository</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_quickReminderRepository</span> <span class="token operator">=</span> <span class="token variable">$quickReminderRepository</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Als voorbeeld het aanmaken van een quick reminder order:
        </p>
        <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">createQuickReminderOrder</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string">'recipient'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'max:255|required'</span><span class="token punctuation">,</span>
            <span class="token string">'send_datetime'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required'</span><span class="token punctuation">,</span>
            <span class="token string">'message'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'required|max:255'</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Set up the new reminder.</span>
    <span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">"recipient"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">recipient</span><span class="token punctuation">,</span>
        <span class="token string">"send_datetime"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">send_datetime</span><span class="token punctuation">,</span>
        <span class="token string">"message"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">message</span><span class="token punctuation">,</span>
        <span class="token string">"is_payed"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Insert the reminder & get the new ID.</span>
    <span class="token variable">$identity</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_quickReminderRepository</span>
                     <span class="token operator">-</span><span class="token operator">></span><span class="token function">insertQuickReminder</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Create the Mollie payment.</span>
    <span class="token variable">$payment</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_mollie</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">payments</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string">"amount"</span>      <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0.50</span><span class="token punctuation">,</span>
        <span class="token string">"description"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"Your quick reminder."</span><span class="token punctuation">,</span>
        <span class="token string">"redirectUrl"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'/thankyou/'</span><span class="token punctuation">.</span><span class="token variable">$identity</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Update the reminder with the payment ID.</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_quickReminderRepository</span>
       <span class="token operator">-</span><span class="token operator">></span><span class="token function">updateQuickReminder</span><span class="token punctuation">(</span><span class="token variable">$identity</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"payment_id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$payment</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Redirect the user to the Mollie payment page.</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: "</span> <span class="token punctuation">.</span> <span class="token variable">$payment</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPaymentUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exit<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Nadat het request gevalideerd is, wordt een nieuwe reminder aangemaakt in de database. De boolean <code>is_payed</code> wordt op <code>false</code>
            gezet. Hierdoor zal de reminder genegeerd worden door de berichtenservice.<br />
            Het ID van de nieuwe reminder wordt meegegeven aan de Mollie API. Ook wordt dit ID verwerkt in de <code>redirectUrl</code>. Wanneer de betaling
            verstuurd is, wordt de reminder geüpdate met de <code>payment_id</code>. Dit ID wordt gebruikt om later de betaalstatus op te vragen.
        </p>
        <p>
            Als de betaling is uitgevoerd, wordt de gebruik geredirect naar de opgegeven URL. Aan de hand van de orderID in deze URL wordt
            de reminder terug opgevraagd uit de database, en wordt de betalingsstatus nagekeken. Is alles goed verlopen, dan wordt de boolean
            <code>is_payed</code> op <code>true</code> gezet, en krijgt de gebruiker te zijn dat de betaling gelukt is. De reminder is nu
            klaar om verstuurd te worden.<br />
            Als er iets is misgelopen, of als de betaling nog niet voltooid is, dan krijgt de gebruiker dit ook te zien.
        </p>
        <pre class="language-php"><code><span class="token variable">$payment</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_mollie</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">payments</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">payment_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Check if the payment is successful.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$payment</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">isPaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Update the reminder & set the message.</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_quickReminderRepository</span>
         <span class="token operator">-</span><span class="token operator">></span><span class="token function">updateQuickReminder</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"is_payed"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"We received your payment successfully!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
    </div>
    <h2 class="subtitle" id="sub4-5">Views</h2>
    <div>
        <p>
            <span class="p-subtitle">Blade templates</span><br />
            Alle pagina's maken gebruik van het Blade templating systeem van Laravel. Dit is een systeem dat veel gelijkenissen toont met Razor in
            ASP.NET. Het zorgt ervoor dat er gemakkelijk layouts gedefiniëerd kunnen worden, en dat scripts en styles op een overzichtelijke manier
            kunnen worden ingeladen. <br />
            Inline PHP code ziet er ook een stuk beter uit door het gebruik van accolades in plaats van <code>&lt;?php?&gt;</code> tags.
        </p>
        <p>
            <span class="p-subtitle">Structuur</span><br />
            De views worden gesorteerd in folders. Elk deel van de site krijgt zijn eigen folder, alsook de errorpagina's en de gedeelde layouts.
            Vue.js maakt ook gebruik van een aantal templates, dat hier ook een eigen folder krijgt
        </p>
        <pre class="folder-structure">
views/
  |-- dashboard/
      `-- home.blade.php
  |-- errors/
      |-- 404.blade.php
      `-- 503.blade.php
  |-- home/
      |-- contact.blade.php
      |-- index.blade.php
      |-- paymentcomplete.blade.php
      `-- pricing.blade.php
  |-- layouts/
      `-- site.blade.php
  `-- vue/
      `-- ...
        </pre>
        <p>
            <span class="p-subtitle">Layouts</span><br />
            De website maakt gebruik van een Blade layout. Dit zorgt ervoor dat gemeenschappelijke delen, zoals header of footer, maar op
            één plaats aangepast hoeven te worden. De verschillende pagina's 'extenden' dan de layout. Scripts of stylesheets die specifiek
            zijn voor een pagina kunnen in sections geplaats worden.<br />
            De structuur van de layout ziet er als volgt uit:
        </p>
        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation"><</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation"><</span>head</span><span class="token punctuation">></span></span>
    ...
    @yield('style')
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation"><</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>header</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>main</span><span class="token punctuation">></span></span>
        @yield('content')
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>footer</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>

    @yield('scripts')
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
        <p>
            Een pagina ziet er dan als volgt uit: eerst wordt aangeduid welke layout gebruikt wordt, en vervolgens wordt voor elke section specifieke
            code geschreven. Moest een pagina bijvoorbeeld geen speciaal script nodig hebben, dan kan deze section gewoon weggelaten worden.
        </p>
        <pre class="language-html"><code>@extends('layouts.site')

@section('style')
    <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ url(<span class="token punctuation">'</span>css/main.css<span class="token punctuation">'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
@endsection

@section('content')
    <span class="token comment" spellcheck="true">&lt;!-- Page specific HTML //--&gt;</span>
@endsection

@section('scripts')
    <span class="token tag"><span class="token tag"><span class="token punctuation"><</span>script</span> <span class="token attr-name">src"myscript.js"</span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
@endsection</code></pre>
        <p>
            De views in de Vue folder worden nog verder besproken in het deel frontend.
        </p>
    </div>
    <h2 class="subtitle" id="sub4-6">Authenticatie</h2>
    <div>
        <p>
            De applicatie maakt gebruik van een RESTful API. Zo'n API is per definitie stateless. Concreet wil dit zeggen dat elk request alle nodige
            informatie bevat om afgehandeld te worden door de server. Dit betekent dat de API technisch gezien geen gebruik mag maken van session
            based authenticatie.<br />
            Alternatieven zoals OAuth en JSON Web Tokens (JWT) bieden hiervoor een oplossing. De applicatie maakt gebruik van dit laatste.
        </p>
        <p>
            <span class="p-subtitle">JSON Web Token</span><br />
            Een JSON Web Token is een compact token dat mee verstuurd kan worden in de header van een request. Het wordt serverside aangemaakt
            en geëncrypteerd aan de hand van een secret key. Hierdoor kan de authenticiteit geverifiëerd worden.
        </p>
        <p>
            Een token bestaat uit 3 delen: header, payload en signature. Deze worden gescheiden door een punt. Een token heeft dus de volgende
            vorm: <br />
            <code>xxxx.yyyy.zzzz</code>
        </p>
        <p>
            De header is een JSON object dat doorgaans bestaat uit twee properties: het type token, en het soort hashing algoritme. Dit object
            wordt vervolgens Base64 geëncodeerd.
        </p>
        <p>
            Het tweede deel, de payload, bevat het grootste deel van de informatie. Ook dit is een JSON object dat Base64 geëncodeerd wordt.
            Het bevat enkele vaste properties, zoals bijvoorbeel de issuer (<code>iss</code>) en de expiration date (<code>exp</code>).
            Naast deze properties kunnen er nog custom properties aangemaakt worden, die bijvoorbeeld meer informatie over de gebruiker
            bevatten.
        </p>
        <p>
            Het laatste deel is de signature. Dit is een geëncrypteerde vorm van de header en de payload, aan de hand van een secret key. Deze
            signature wordt gebruikt om de authenticiteit te verifiëren. Het bevat de header en de payload om ervoor te zorgen dat deze niet
            gewijzigd kunnen worden.
        </p>
        <div class="keep-together">
            <p>
                Een token kan er dan uitendelijk als volgt uitzien:
            </p>
            <p>
                <span class="jwt-color-1">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.<br />
                <span class="jwt-color-2">eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9</span>.<br />
                <span class="jwt-color-3">TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span>
            </p>
        </div>
        <p>
            <span class="p-subtitle">JWT Auth</span><br />
            De applicatie maakt gebruikt van de <code>tymon/jwt-auth</code> library. Deze open-source library is specifiek voor Laravel geschreven
            en biedt alle nodige middelen om met JWT te werken. Zo voorziet het bijvoorbeeld een method om van een user een token te maken met
            <code>JWTAuth::fromUser()</code>, of de <code>make()</code> method om een eigen payload te maken.
        </p>
        <p>
            De library voorziet ook een eigen authenticatie middleware. Deze middleware zal het token uit een request halen en proberen een gebruiker
            te authenticeren. Alle API controllers die authenticatie nodig hebben worden dan ook gegroepeerd onder deze middleware. Dit gebeurt in het
            <code>routes.php</code> bestand.
        </p>
        <pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'namespace'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'API'</span><span class="token punctuation">,</span> <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'api'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'middleware'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'jwt.auth'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Routes die authenticatie nodig hebben.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Overige API routes</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

    </div>
    <h2 class="subtitle" id="sub4-7">Berichtenservice</h2>
    <div>
        <p>
            Om reminders per SMS te versturen maakt de applicatie gebruik van een Laravel command. Dit is een class die zowel in de applicatie
            gebruikt kan worden, alsook via de console. Zo kunnen de reminders verstuurd worden via het volgende console command:
        </p>
            <code>$ php artisan reminders:check</code><br />
        <p>
            Via een cronjob wordt dit command elke minuut uitgevoerd. De class wordt opgeslagen in <code>app/Console/Commands</code> en
            ziet er als volgt uit:
        </p>
        <pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">CheckReminders</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token string">'reminders:check'</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$description</span> <span class="token operator">=</span> <span class="token string">'Checks if there are ...'</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token variable">$_quickReminderRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userReminderRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_contactRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_sendReminder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_handleRepeatedReminder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_getRecipient</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            In de constructor worden weer de gebruikte repositories geïnjecteerd. De kern van de logica bevindt zich in de <code>handle()</code>
            method. Hier worden eerst alle reminders opgehaald die een <code>send_datetime</code> hebben eerder dan de huidige datetime.
            Voor elk van deze berichten wordt dan een SMS verstuurd met behulp van de Twilio API. De Twilio library zorgt ervoor dat dit in
            één regel code kan:
        </p>
        <pre class="language-php"><code>Twilio<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">recipient</span><span class="token punctuation">,</span> <span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
        <p>
            Naast het versturen van het bericht, wordt er ook nog een log hiervan gemaakt. Dit gebeurt allebei in de <code>_sendReminder()</code>
            method. <br />
            Voor quick reminders houdt het er hierbij op. Voor user reminders daarentegen moet er ook nog gekeken worden of de reminder herhaalt dient te worden.
            Als dit het geval is, wordt er een nieuwe reminder aangemaakt met een latere <code>send_datetime</code>. Het gebruik van de PHP
            <code>DateTime</code> class zorgt dat dit in duidelijke code kan gebeuren.
        </p>
        <pre class="language-php"><code><span class="token variable">$newDate</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>DateTime</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">send_datetime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">repeat_id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Daily.</span>
        <span class="token variable">$newDate</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string">"P1D"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Weekly.</span>
        <span class="token variable">$newDate</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string">"P7D"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Monthly.</span>
        <span class="token variable">$newDate</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string">"P1M"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// Yearly.</span>
        <span class="token variable">$newDate</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string">"P1Y"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            De <code>_getRecipient()</code> method is een helperfunctie die nagaat of de reminder een <code>contact_id</code> heeft. Als dit zo is,
            dan wordt het nummer van de bijhorende contactpersoon opgehaald.
        </p>
        <p>
            <span class="p-subtitle">Scheduler</span><br />
            Laravel voorziet een Task Scheduler. Hier maakt de applicatie dan ook gebruik van. Om van de scheduler gebruik te kunnen maken, moet er
            een cronjob opgesteld worden op de server:
        </p>
            <code>* * * * * php /path/to/artisan schedule:run >> /dev/null 2>&1</code><br />
        <p>
            Deze cronjob voert elke minuut het artisan command <code>schedule:run</code> uit. Wat dit command doet wordt bepaald in
            <code>app/Console/Kernel.php</code>. Omdat we een apart command hebben geschreven voor de berichtenservice, is deze class
            heel compact:
        </p>
        <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Console</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Scheduling<span class="token punctuation">\</span>Schedule</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Kernel</span> <span class="token keyword">as</span> ConsoleKernel<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Kernel</span> <span class="token keyword">extends</span> <span class="token class-name">ConsoleKernel</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * The Artisan commands provided by your application.
     *
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$commands</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        Commands\<span class="token package">CheckReminders</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Define the application's command schedule.
     *
     * @param  \Illuminate\Console\Scheduling\Schedule  $schedule
     * @return void
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span>Schedule <span class="token variable">$schedule</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Checks if there are reminders that need to be sent.</span>
        <span class="token variable">$schedule</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'reminders:check'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">everyMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
    </div>
    <h2 class="subtitle" id="sub6-8">Unit Testing</h2>
    <div>
        <p>
            //ToDo
        </p>
    </div>
<h1 id="ch5" class="chapter">Frontend</h1>
    <h2 class="subtitle" id="sub5-1">Gebruikte technologiën</h2>
    <div>
        <table class="gebruikte-techs">
            <tbody>
                <tr>
                    <td>
                        <img src="images/techs/vuejs.png" id="logo-vuejs"/>
                    </td>
                    <td>
                        <span class="tech-title">Vue.js</span><br />
                        Vue is een klein en flexibel JavaScript framework. Het stelt ons in staat om snel interactieve pagina's
                        te maken. Het is vergelijkbaar met andere MV* frameworks zoals Angular of React, en deelt ook veel eigenschappen.
                        Het dashboard van de applicatie is volledig rond dit framework gebouwd.
                        <br /><span class="tech-alts">Alternatieven:</span> AngularJS, React
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/bootstrap.png" id="logo-bootstrap" />
                    </td>
                    <td>
                        <span class="tech-title">Bootstrap Grid</span><br />
                        Omdat Bootstrap sites vaak erg op elkaar lijken, heb ik ervoor gekozen om de styling van de site volledig
                        zelf te schrijven. Wel gebruik ik het gridsysteem om responsive design te vergemakkelijken.<br />
                        Op de website van Bootstrap kunnen custom builds compiled worden. De applicatie maakt gebruik van een build die enkel
                        het gridsysteem bevat, met wat kleine aanpassingen.
                        <br /><span class="tech-alts">Alternatieven:</span> Foundation, Kickstart
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/fa.png" id="logo-fa" />
                    </td>
                    <td>
                        <span class="tech-title">Font Awesome</span><br />
                        Font Awesome is een populair icon font. Het zorgt voor kwalitatieve icons, die gemakkelijk zijn in het gebruik.
                        Font Awesome voorziet zelfs handige CSS classes om bijvoorbeeld een loading icon te spinnen.
                        <br /><span class="tech-alts">Alternatieven:</span> Glyphicons, Fontello
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div>
    </div>
    <h2 class="subtitle" id="sub5-2">Vue.js</h2>
    <div>
        <p>
            Vue is een JavaScript framework dat staat voor flexibiliteit en snelheid. Het is simpel om te gebruiken dankzij zijn intuïtieve
            syntax. Het is een soort 'Angular Lite', met kenmerken van andere frameworks zoals React. Om Vue klein te houden, bevat het enkel de
            kern functionaliteit. Functionaliteiten die niet overal nodig zijn worden in aparte componenten gehouden. Zo gebruikt de applicatie
            ook de <code>vue-router</code> package, om routing te voorzien, en de <code>vue-resources</code> package, om makkelijk HTTP requests
            te kunnen sturen.
        </p>
        <p>
            
        </p>
    </div>
    <h2 class="subtitle" id="sub5-3">Routing</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-4">Mixins</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-5">Stores</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-6">Dashboard Home</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-7">Contacts</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-8">Account</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-9">Authenticatie</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-10">Datetime picker</h2>
    <div>
        <p>
            ...
        </p>
    </div>
    <h2 class="subtitle" id="sub5-11">Homepage</h2>
    <div>
        <p>
            ...
        </p>
    </div>

<h1 id="ch6" class="chapter">Conclusie</h1>
<div>
    <p>
        ...
    </p>
</div>

</body>
</html>
