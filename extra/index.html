<!DOCTYPE html>
<!-- prince -s style.css index.html mybook.pdf -->
<!-- prince  index.html builds/eindwerk.pdf  --javascript -->
<html dir="ltr" lang="en-US">
<head>
    <meta charset="utf-8" />
    <title>Eindwerk Paper</title>
    <meta name="author" content="Mark gerarts"/>
    <meta name="subject" content="Eindwerk Syntra Webontwikkelaar 2015-2016: ReminderApp"/>
    <link rel="stylesheet" href="highlight/styles/tomorrow.css" />
    <script src="highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="frontcover">
    <img src="images/syntra-logo.jpg" id="logo" />
    <div id="title">
        <h2>RemindMe</h2>
    </div>
</div>
<div class="contents">
    <h1>Inhoud</h1>

    <ul class="toc">
        <li><a href="#ch1"></a></li>
        <li><a href="#ch2"></a></li>
        <li><a href="#ch3"></a></li>
        <li><a href="#ch4"></a>
            <ul class="toc toc-sub">
                <li><a href="#sub4-1"></a></li>
                <li><a href="#sub4-2"></a></li>
                <li><a href="#sub4-3"></a></li>
                <li><a href="#sub4-4"></a></li>
                <li><a href="#sub4-5"></a></li>
                <li><a href="#sub4-6"></a></li>
                <li><a href="#sub4-7"></a></li>
            </ul>
        </li>
        <li><a href="#ch5"></a>
            <ul class="toc toc-sub">
                <li><a href="#sub5-1"></a></li>
                <lI><a href="#sub5-2"></a></lI>
            </ul>
        </li>
        <li><a href="#ch6"></a></li>
    </ul>

</div>

<!-- Inleiding en samenvatting omwisselen, a la abstract //-->
<h1 id="ch1" class="chapter">Inleiding</h1>
    <div>
        <p>
            RemindMe is een webapplicatie waarmee gebruikers een herinnering kunnen maken, die ze later dan per sms toegestuurd krijgen. Er kan een account aangemaakt worden. Dit biedt
            onder andere de mogelijkheid om contacten te beheren en herinneringen te laten herhalen. Registreren is echter niet nodig, er kon ook een
            zogenaamde 'Quick reminder' gemaakt worden. Het nadeel hiervan is dat de prijs veel hoger ligt.
        </p>
        <p>
            De applicatie is geschreven in Laravel. Wanneer een gebruiker zich inlogt, komt hij terecht bij het 'dashboard'. Dit deel van de site maakt gebruikt van het JavaScript
            framework Vue.js. Deze communiceert met de backend door middel van een API.

        </p>
    </div>

<h1 id="ch2" class="chapter">Samenvatting</h1>
    <p>Zie inleiding.</p>

<h1 id="ch3" class="chapter">Database</h1>
    <div>
        <p>
            De applicatie maakt gebruik van een MySQL (MariaDB) database. De structuur ziet er als volgt uit:
        </p>
        <!-- Database tables a la MySQL //-->
        <div class="db-wrapper">
            <!-- Users //-->
            <ul class="db-table">
                <li class="db-header">users</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />name
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />email
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />password
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />reminder_credits
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />remember_token
                    <span class="db-datatype"> : varchar(100)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- User_reminders //-->
            <ul class="db-table">
                <li class="db-header">user_reminders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />recipient
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />contact_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />send_datetime
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />message
                    <span class="db-datatype"> : text</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />repeat_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- User_orders //-->
            <ul class="db-table">
                <li class="db-header">user_orders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />payment_id
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />amount
                    <span class="db-datatype"> : decimal(8,2)</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />reminder_credits
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- Quick reminders //-->
            <ul class="db-table">
                <li class="db-header">quick_reminders</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />recipient
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />send_datetime
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />message
                    <span class="db-datatype"> : text</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />updated_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />deleted_at :
                    <span class="db-datatype"> : datetime</span>
                </li>
                <li>
                    <img src="images/pma/int.png" />is_payed :
                    <span class="db-datatype"> : tinyint(1)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />payment_id
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
            </ul>
            <!-- Contacts //-->
            <ul class="db-table">
                <li class="db-header">contacts</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />name
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />number
                    <span class="db-datatype"> : varchar(20)</span>
                </li>
                <li class="db-foreign-key">
                    <img src="images/pma/int.png" />user_id
                    <span class="db-datatype"> : int(11)</span>
                </li>
            </ul>
            <!-- Password_resets //-->
            <ul class="db-table">
                <li class="db-header">password_resets</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />email
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />token
                    <span class="db-datatype"> : varchar(255)</span>
                </li>
                <li>
                    <img src="images/pma/datetime.png" />created_at
                    <span class="db-datatype"> : datetime</span>
                </li>
            </ul>
            <!-- Repeats //-->
            <ul class="db-table" id="db-table-repeats">
                <li class="db-header">repeats</li>
                <li>
                    <img src="images/pma/primary_key.png" />id
                    <span class="db-datatype"> : int(11)</span>
                </li>
                <li>
                    <img src="images/pma/varchar.png" />repeat_interval
                    <span class="db-datatype"> : varchar(20)</span>
                </li>
            </ul>
        </div>
        <p>
            <strong>Users:</strong><br />
            Deze tabel bevat details over de gebruiker, samen met een aantal timestamps. Het wachtwoord wordt gehashed in de database opgeslagen. Het veld "reminder_credits" bevat
            het aantal reminders dat de gebruiker nog heeft.
        </p>
        <p>
            <strong>User_reminders</strong><br />
            Bevat reminders die door een geregistreerde gebruiker gemaakt zijn. Zo'n reminder wordt ofwel naar een opgeslagen contact verstuurd, of naar een willekeurig nummer. Daarom
            heeft deze tabel naast het veld "recipient" ook nog een referentie naar de Contacts tabel.
        </p>
        <p>
            <strong>User_orders</strong><br />
            Bevat gegevens over betalingen die door geregistreerde gebruikers worden uitgevoerd. Zo wordt het bedrag opgeslagen, en het aantal reminders dat gekocht werd. "Payment_id"
            verwijst naar de betaling die via de Mollie API wordt gemaakt. Dit kan gebruikt worden om de betalingsstatus na te gaan.
        </p>
        <p>
            <strong>Quick_reminders</strong><br />
            Hier worden alle details opgeslagen over reminders die door niet-geregistreerde gebruikers worden gemaakt. Ook hier wordt een referentie naar de betaling van Mollie bijgehouden.
            Ook is er een boolean voorzien om na te gaan of de betaling al voltooid is of niet. Dit om ervoor te zorgen dat er niet elke minuut een request naar de Mollie API gestuurd dient
            te worden.
        </p>
        <p>
            <strong>Contacts</strong><br />
            De tabel om contacten in op te slaan. Elke rij bevat een verwijzing naar de user waarmee ze geässocieerd is.
        </p>
        <p>
            <strong>Password_resets</strong><br />
            Deze tabel is nodig om gebruikers de mogelijkheid te geven hun wachtwoord te veranderen.
        </p>
        <p>
            <strong>Repeats</strong><br />
            Dit is niet meer dan een enum voor de beschikbare herhalingen.
        </p>
    </div>

<h1 id="ch4" class="chapter">Backend</h1>
    <h2 class="subtitle" id="sub4-1">Gebruikte technologiën</h2>
    <div>
        <table class="gebruikte-techs">
            <tbody>
                <tr>
                    <td>
                        <img src="images/techs/laravel.png" id="logo-laravel"/>
                    </td>
                    <td>
                        <span class="tech-title">Laravel 5.2</span><br />
                        Laravel is het meest gebruikte PHP framework. Het bevat veel tools die het ontwikkelingsproces helpen versnellen. Zo maakt het gebruik
                        van artisan om code te genereren voor veelgebruikte zaken. De Eloquent ORM vergemakkelijkt database operaties, en het Blade templating
                        systeem zorgt voor overzichtelijke views.
                        Bovenop dit alles beschikt Laravel over een expressieve en elegante syntax.<br />
                        Persoonlijk heb ik voor Laravel gekozen omwille van de gelijkenissen met ASP.NET, een C# framework waar ik al eerder ervaring in had.
                        <br /><span class="tech-alts">Alternatieven:</span> CodeIgniter, CakePHP, Symfony
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/twilio.png" id="logo-twilio"/>
                    </td>
                    <td>
                        <span class="tech-title">Twilio</span><br />
                        Om SMS-berichten te versturen kunnen maakt de applicatie gebruik van Twilio. Deze service voorziet een API, waardoor een bericht
                        verstuurd kan worden door middel van een HTTP request. Twilio voorziet ook een library die beschikbaar is via Composer. Dit zorgt ervoor
                        dat de service snel opgezet kan worden.
                        <br /><span class="tech-alts">Alternatieven:</span> Plivo, Nexmo
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/mollie.png" id="logo-mollie"/>
                    </td>
                    <td>
                        <span class="tech-title">Mollie</span><br />
                        Mollie is een service om online betalingen te regelen. Het voorziet veel betalingsmogelijkheden, gaande van Bancontact tot Paypal en zelfs
                        bitcoin. Mollie host een API en voorziet hiervoor ook een PHP library, wat maakt dat er met een paar regels code al een betaling kan worden
                        uitgevoerd.<br />
                        Voor de ontwikkeling van een applicatie kan een test-API gebruikt worden. Deze stelt de developer in staat om betalingen na te bootsen, zonder
                        deze effectief uit te voeren.
                        <br /><span class="tech-alts">Alternatieven:</span> Adyen, Ingenico
                    </td>
                </tr>
                <tr>
                    <td>
                        <img src="images/techs/jwt.png" id="logo-jwt"/>
                    </td>
                    <td>
                        <span class="tech-title">JSON Web Token</span><br />
                        De applicatie maakt hevig gebruik van een API. Een RESTful API is per definitie stateless. Dit wil zeggen dat session-based authenticatie geen
                        goede optie is. JSON Web Token (JWT) biedt hiervoor een oplossing. Een token bevat geëncrypteerde authenticatiegegevens van de gebruiker, en wordt
                        client-side bijgehouden. Dit token wordt meegegeven in de header van elk request naar de API, om zo de gebruiker te kunnen authenticeren.<br />
                        De applicatie maakt gebruik van de opensource tymon/jwt-auth library, specifiek voor Laravel.
                        <br /><span class="tech-alts">Alternatieven:</span> OAuth, basic
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <h2 class="subtitle" id="sub4-2">Structuur</h2>
    <div>
        <p>
            Het dashboard van de applicatie is een zogenaamde 'Single Page Application (SPA)'. Bij het navigeren naar het dashboard wordt eenmalig alle nodige code geladen.
            Een JavaScript framework zorgt ervoor dat alle requests asynchroon geladen worden. Ook de routing wordt afgehandeld door het framework. Hierdoor hoeft de gebruiker
            nooit rechtstreeks een nieuwe pagina op te vragen of te herladen. Dit zorgt voor een vlotte user experience.<br />
            Om dit allemaal te kunnen voorzien maakt de applicatie gebruik van een RESTful API.
        </p>
        <p>
            De API voorziet een aantal endpoints om met de applicatie te werken. Ze maakt gebruik van de zogenaamde 'HTTP werkwoorden' die overeenstemmen met een CRUD operatie.
            Zo staat een POST request voor een insert, GET voor een read, PUT voor een update, en een DELETE request zorgt voor een delete.<br />
            Deze requests worden gebundeld onder de 'api' route. Om bijvoorbeeld alle contacten op te vragen, dient er een GET request gestuurd te worden naar '../api/contacts'.
            De API maakt gebruik van JSON als dataformaat. De server stuurt ook logische HTTP statuscodes. Een niet gevonden record geeft bijvoorbeeld een 404 als antwoord, of
            een niet geauthorizeerde actie levert een 403 op.
        </p>
        <table class="api-endpoints">
            <thead>
                <tr>
                    <th>Endpoint</th>
                    <th>Method</th>
                    <th>Omschrijving</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>/contacts/{id?}</td>
                    <td>GET</td>
                    <td>Antwoord met een array van alle contactpersonen van de geauthenticeerde gebruiker, of met slechts 1 contactpersoon als er een id wordt gegeven</td>
                </tr>
                <tr>
                    <td>/contacts</td>
                    <td>POST</td>
                    <td>Insert een contactpersoon aan de hand van de POST-gegevens.</td>
                </tr>
                <tr>
                    <td>/contacts/{id}</td>
                    <td>DELETE</td>
                    <td>Delete de contactpersoon met het gegeven ID.</td>
                </tr>
                <tr class="section-end">
                    <td>/contacts</td>
                    <td>PUT</td>
                    <td>Update de contactpersoon aan de hand van de gegevens.</td>
                </tr>
                <tr>
                    <td>/reminders/upcoming</td>
                    <td>GET</td>
                    <td>Antwoord met een array van alle reminders met een datum later dan vandaag.</td>
                </tr>
                <tr>
                    <td>/reminders/cancel/{id}</td>
                    <td>GET</td>
                    <td>Annuleert de reminder met het gegeven ID.</td>
                </tr>
                <tr>
                    <td>/reminders</td>
                    <td>POST</td>
                    <td>Insert een nieuwe reminder aan de hand van de POST-gegevens.</td>
                </tr>
                <tr class="section-end">
                    <td>/quickreminder</td>
                    <td>POST</td>
                    <td>Insert een quick reminder aan de hand van de POST-gegevens.</td>
                </tr>
                <tr>
                    <td>/login</td>
                    <td>POST</td>
                    <td>Probeert een gebruiker te authenticeren. Antwoord met een JWT als de authenticatie succesvol is</td>
                </tr>
                <tr>
                    <td>/register</td>
                    <td>POST</td>
                    <td>Registreert een nieuwe gebruiker.</td>
                </tr>
                <tr>
                    <td>/user</td>
                    <td>GET</td>
                    <td>Antwoord met enkele gegevens van de geauthenticeerde gebruiker.</td>
                </tr>
            </tbody>
        </table>
    </div>
    <h2 class="subtitle" id="sub4-3">Models & Repositories</h2>
    <div>
        <p>
            <span class="p-subtitle">Eloquent ORM</span><br />
            Laravel maakt gebruikt van het Eloquent ORM. Elk Eloquent model komt overeen met een tabel in de database. Op dit model kunnen dan relaties
            gedefiniëerd worden. Standaard komt de classnaam overeen met de tabelnaam. Zo zal het model Contact queries uitvoeren op de 'contacts' tabel.
            Het Contact model ziet er bijvoorbeeld als volgt uit:
        </p>
        <!-- Contact Model code -->
    <pre class="language-php"><code>
<span class="token keyword">class</span> <span class="token class-name">Contact</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$timestamps</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            De <code>$timestamps</code> property wordt gebruikt om aan te duiden of er voor een model de datum moet worden bijgehouden waarop het aangemaakt of gewijzigd wordt.<br />
            Relaties met andere tabellen worden aangeduid aan de hand van functies. Zo wordt bijvoorbeeld een OneToMany relatie uitgedrukt door <code>hasMany()</code> en
            <code>belongsTo()</code>.
        </p>
        <p>
            Eloquent zorgt ervoor dat veelgebruikte queries geëncapsuleerd worden op de models. Zo voorziet het enkele logische functies zoals <code>delete()</code>, <code>save()</code>,
            <code>where()</code>, enz.
            Meer complexe operaties kunnen nog altijd in rauwe SQL worden uitgevoerd.
        </p>
        <p>
            <span class="p-subtitle">Repository pattern</span><br />
            De applicatie maakt gebruik van het repository pattern. Dit is een extra abstractie van de database layer. Een repository bundelt een aantal operaties op
            een model in een class. De controller hoeft dan niet langer rechtstreeks de database layer aan te spreken via de models, maar gebruikt in de plaats de
            repositories.<br />
            De repository en het model zijn zo echter wel nog tightly coupled. Om dit tegen te gaan worden interfaces gebruikt. De interface definiëert een 'contract'
            waar de repository zich aan moet houden. In de controller wordt vervolgens de interface als dependency gebruikt. Nu maakt het niet meer uit hoe de data
            opgehaald wordt, als de implementatie zich maar aan de interface houdt. <br />
            Het gebruik van repositories zorgt niet enkele voor beter leesbare code, maar verbetert ook de mogelijkheid
            tot unit testing.
        </p>
        <p>
            De interface voor de contactpersonen ziet er bijvoorbeeld als volgt uit:
        </p>
        <!-- Code voor de repositoryinterface //-->
    <pre class="language-php"><code><span class="token keyword">interface</span> <span class="token class-name">IContactRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactById</span><span class="token punctuation">(</span><span class="token variable">$contactid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactsByUserId</span><span class="token punctuation">(</span><span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insertContact</span><span class="token punctuation">(</span><span class="token variable">$contact</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">deleteContact</span><span class="token punctuation">(</span><span class="token variable">$contactid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">updateContact</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$newValues</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Vervolgens implementeert de repository de bijhorende interface. Zo ziet de <code>getContactsByUserId()</code> er als volgt uit.
        </p>
        <!-- Code voor de interface implementatie //-->
    <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Repositories<span class="token punctuation">\</span>Contact</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Contact</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ContactRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IContactRepository</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_contact</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Contact <span class="token variable">$contact</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contact</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getContactsByUserId</span><span class="token punctuation">(</span><span class="token variable">$userid</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">,</span> <span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
        <p>Om de repository te gebruiken wordt de interface geïnjecteerd in de constructor.</p>
        <!-- Constructor code //-->
    <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>IContactRepository <span class="token variable">$contact</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            Omdat enkel de interface wordt gebruikt in de controller, weet Laravel niet welke implementatie ze hiervoor moet gebruiken. Daarom moeten de interface en
            de bijhorende implementatie aan elkaar gekoppeld worden. Dit gebeurt in de <code>register</code> method in de <code>AppServiceProvider</code>.
         </p>
         <!-- Code voor de app_>bind() //-->
         <pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'App\Repositories\Contact\IContactRepository'</span><span class="token punctuation">,</span>
        <span class="token string">'App\Repositories\Contact\ContactRepository'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
        <p>
            <span class="p-subtitle">Structuur</span><br />
            Elk model krijgt op deze manier zijn eigen repository. Omdat dit project relatief klein is, heeft elke repository zijn eigen interface.
            Een betere oplossing voor grotere projecten is om een basis interface te schrijven met algemene CRUD acties. Vervolgens kunnen specifieke
            interfaces deze erven en eventueel nog methods toevoegen of aanpassen.
        </p>
        <div class="keep-together">
            <p>
                De folderstructuur voor de models ziet er als volgt uit:
            </p>
            <pre class="folder-structure">
app/
  ...
  .
  |-- Models/
      |-- Contact.php
      |-- Quick_reminder.php
      |-- User_order.php
      |-- User_reminder.php
      `-- User.php
  `-- Repositories/
      |-- Contact/
          |-- ContactRepository.php
          `-- IContactRepository.php
      |-- Quick_reminder/
          |-- Quick_reminderRepository.php
          `-- IQuick_reminderRepository.php
      |-- User_order/
          |-- User_orderRepository.php
          `-- IUser_orderRepository.php
      |-- User_reminder/
          |-- User_reminderRepository.php
          `-- IUser_reminderRepository.php
      `-- User/
          |-- UserRepository.php
          `-- IUserRepository.php
            </pre>
        </div>
        <p>
            Alle repositories hebben enkele basis CRUD methods. De enige repository die hiervan afwijkt is de UserRepository. De <code>tymon/jwt-auth</code>
            library gebruikt standaard het zijn eigen UserInterface. Daarom moet de UserRepository een extra interface implementeren. Ook moet in
            <code>config/jwt.php</code> een verwijzing toegevoegd worden naar de nieuwe implementatie.
        </p>
        <pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Repositories<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tymon<span class="token punctuation">\</span>JWTAuth<span class="token punctuation">\</span>Providers<span class="token punctuation">\</span>User<span class="token punctuation">\</span>UserInterface</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">IUserRepository</span><span class="token punctuation">,</span> UserInterface
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
    </div>
    <h2 class="subtitle" id="sub4-4">Controllers</h2>
    <div>
        <p>
            De controllers worden opgesplits in twee delen. Enerzijds zijn er de controllers die verantwoordelijk zijn voor de API. Deze bevatten allerhande
            methods om de gewenste database operaties uit te voeren. Anderzijds zijn er de controllers die de webpagina's genereren. Deze doen vaak niets anders
            dan een view returnen.
        </p>
        <pre class="folder-structure">
Controllers/
  |-- API/
      |-- AuthenticateController.php
      |-- ContactsController.php
      |-- RemindersController.php
      `-- UserController.php
  |-- Controller.php
  |-- DashboardController.php
  |-- HomeController.php
  `-- PaymentController.php
        </pre>
        <p>
            <span class="p-subtitle">ContactsController</span><br />
            De ContactsController is niet meer dan een bundeling van CRUD operaties. De methods krijgen dan ook namen die overeenstemmen met de actie.
        </p>
        <!-- Code voor contact controller //-->
<pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>API</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Requests</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">ContactsController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$_contactRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userRepository</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$_userReminderRepository</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token variable">$_user</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            In de constructor worden de nodige repositories via dependency injection geïnstantieerd. Deze worden dan als properties bijgehouden om zo
            gebruikt te kunnen worden in de methods.
        </p>
        <!-- ContactsController constructor //-->
        <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>IContactRepository <span class="token variable">$contact</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_user</span> <span class="token operator">=</span> JWTAuth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">parseToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span> <span class="token operator">=</span> <span class="token variable">$contact</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userRepository</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span> <span class="token operator">=</span> <span class="token variable">$userReminder</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            De ContactsController kan alleen maar gebruikt worden als de user geauthenticeerd is, en gebruikt daarom de <code>jwt.auth</code>
            middleware. De geauthenticeerde gebruiker wordt via de <code>toUser()</code> method in een property gestoken.
        </p>
        <p>
            Vrijwel alle methods volgen de zelfde structuur. Eerst wordt de eventuele input gevalideerd. Vervolgens wordt de logica uitgevoerd
            die van de method verwacht wordt. Ten slotte wordt er een JSON antwoord teruggestuurd. Moest er ergens in de method iets foutlopen,
            dan wordt ook een logische HTTP code teruggestuurd. Zo zal foutieve data voor een 422 code zorgen.<br />
            Als voorbeeld de <code>delete()</code> method:
        </p>
        <!-- Delete contactscontroller //-->
    <pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Get the contact.</span>
    <span class="token variable">$contact</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getContactById</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$contact</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">"Not found"</span><span class="token punctuation">,</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// Check if the contact really belongs to the user.</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">user_id</span> <span class="token operator">!=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">"Not authorized"</span><span class="token punctuation">,</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Remove the contact id from all associated reminders, and</span>
    <span class="token comment" spellcheck="true">// set the recipient to the contact's number.</span>
    <span class="token comment" spellcheck="true">// This is so the set reminders can still be sent.</span>
    <span class="token variable">$reminders</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span>
                      <span class="token operator">-</span><span class="token operator">></span><span class="token function">getUserRemindersWhere</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"contact_id"</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$reminders</span> <span class="token keyword">as</span> <span class="token variable">$reminder</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_userReminderRepository</span>
             <span class="token operator">-</span><span class="token operator">></span><span class="token function">updateUserReminder</span><span class="token punctuation">(</span><span class="token variable">$reminder</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                 <span class="token string">"recipient"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$contact</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">number</span><span class="token punctuation">,</span>
                 <span class="token string">"contact_id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span>
             <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// Finally, delete the contact & return the result.</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_contactRepository</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">deleteContact</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
        <p>
            <span class="p-subtitle">RemindersController</span><br />
            De RemindersController is verantwoordelijk voor de operaties op de User_reminders tabel. Deze is vrijwel analoog aan de ContactsController.
            Het enige verschil hier is dat er een extra <code>_createUserReminder()</code> method is. Deze wordt gebruikt bij <code>insertReminder()</code>.
            Dit is een aparte method om de code overzichtelijker te maken.
        </p>
        <!-- RemindersController //-->
        <pre class="php"><code>namespace App\Http\Controllers\API;

use ...;

class RemindersController extends Controller
{
    private $_userRepository;
    private $_userReminderRepository;
    private $_user;

    public function __construct(..) { .. }

    public function getUpcomingReminders() { .. }

    public function insertReminder(..) { .. }

    public function cancelReminder(..) { .. }

    private function _createUserReminder(..) { .. }
}
        </code></pre>
        <p>
            <span class="p-subtitle">AuthenticateController</span><br />
            Deze controller zorgt voor de authenticatie en registratie van de gebruiker.
        </p>
        <p>
            Folderstructuur, requests, validatie, ...
        </p>
    </div>
    <h2 class="subtitle" id="sub4-5">Views</h2>
    <div>
        <p>
            Blade templates, layouts, sections, JSON?, ...
        </p>
    </div>
    <h2 class="subtitle" id="sub4-6">Authenticatie</h2>
    <div>
        <p>
            JWT uitleggen: 3 delen, headers, middleware, ...
        </p>
    </div>
    <h2 class="subtitle" id="sub4-7">Berichten service</h2>
    <div>
        <p>Scheduler, reminders:check command</p>
    </div>
<h1 id="ch5" class="chapter">Frontend</h1>
    <h2 class="subtitle" id="sub5-1">Gebruikte technologiën</h2>
    <div>
        <p>VueJS, grid, fa, ....</p>
    </div>
    <h2 class="subtitle" id="sub5-2">Structuur</h2>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolorum unde, pariatur dicta ipsa commodi, sit quasi autem blanditiis nesciunt ullam harum
            accusantium neque in incidunt modi labore quis nulla iure.
        </p>

<h1 id="ch6" class="chapter">Conclusie</h1>
<p>… </p>

</body>
</html>
